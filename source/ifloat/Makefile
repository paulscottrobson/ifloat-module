# *******************************************************************************************
# *******************************************************************************************
#
#		Name : 		Makefile
#		Purpose :	Make tables for ifloat module
#		Date :		9th December 2024
#		Author : 	Paul Robson (paul@robsons.org.uk)
#
# *******************************************************************************************
# *******************************************************************************************

include ../../build_env/common.make

DECIMALS = 1 0.1 0.01 0.001 0.0001 0.00001 0.000001 0.0000001 0.00000001 \
		   0.000000001 0.0000000001 0.00000000001 0.000000000001 0.0000000000001 \
		   0.00000000000001 0.000000000000001 0.0000000000000001
all: 
	#
	#		Copy reference ifloat.py => scripts directory
	#
	cp $(ROOTDIR)documents/ifloat-reference/ifloat.py $(SCRIPTDIR)_ifloat_copy.py
	#
	#		Generate the powers of 10 Scalar table
	#
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatScalarTable $(DECIMALS) >base/utilities/_scalars.asm
	#
	#		Copy the coefficients from the reference implementation of the taylor series polynomials
	#
	cp $(ROOTDIR)documents/ifloat-reference/coefficients.acme polynomial/enable/_coefficients.asm
	#
	#		Generate the table of floats used in those polynomial evaluations
	#
	echo "; this file is automatically generated" >polynomial/enable/_constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_1Div2Pi 	"1/(2*math.pi)" 		>>polynomial/enable/_constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_PiDiv2 		"math.pi/2" 			>>polynomial/enable/_constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_Log2 		"math.log(2)" 			>>polynomial/enable/_constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_Log2_E 		"math.log(math.e,2)" 	>>polynomial/enable/_constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_Sqr2 		"math.sqrt(2)" 			>>polynomial/enable/_constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_MinusSqr2 	"-math.sqrt(2)" 		>>polynomial/enable/_constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_Sqr0_5 		"math.sqrt(0.5)" 		>>polynomial/enable/_constants.asm
