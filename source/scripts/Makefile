# *******************************************************************************************
# *******************************************************************************************
#
#		Name : 		Makefile
#		Purpose :	Make tables for ifloat module
#		Date :		9th December 2024
#		Author : 	Paul Robson (paul@robsons.org.uk)
#
# *******************************************************************************************
# *******************************************************************************************

include ../../build_env/common.make

DECIMALS = 1 0.1 0.01 0.001 0.0001 0.00001 0.000001 0.0000001 0.00000001 \
		   0.000000001 0.0000000001 0.00000000001 0.000000000001 0.0000000000001 \
		   0.00000000000001 0.000000000000001 0.0000000000000001

.any:
	
build: .any
	#
	#		Copy reference ifloat.py => scripts directory
	#
	cp $(ROOTDIR)ifloat-reference/ifloat.py $(SCRIPTDIR)__ifloat_copy.py
	#
	#		Generate the powers of 10 Scalar table
	#
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatScalarTable $(DECIMALS) >$(SOURCEDIR)base/utilities/__scalars.asm
	#
	#		Copy the coefficients from the reference implementation of the taylor series polynomials
	#
	cp $(ROOTDIR)ifloat-reference/coefficients.data $(SOURCEDIR)polynomial/__coefficients.asm
	#
	#		Generate the table of floats used in those polynomial evaluations
	#
	echo "; this file is automatically generated" >$(SOURCEDIR)polynomial/__constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_1Div2Pi 	"1/(2*math.pi)" 		>>$(SOURCEDIR)polynomial/__constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_PiDiv2 		"math.pi/2" 			>>$(SOURCEDIR)polynomial/__constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_Log2 		"math.log(2)" 			>>$(SOURCEDIR)polynomial/__constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_Log2_E 		"math.log(math.e,2)" 	>>$(SOURCEDIR)polynomial/__constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_Sqr2 		"math.sqrt(2)" 			>>$(SOURCEDIR)polynomial/__constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_MinusSqr2 	"-math.sqrt(2)" 		>>$(SOURCEDIR)polynomial/__constants.asm
	$(PYTHON) $(SCRIPTDIR)generate_ifloat.py FloatConst_Sqr0_5 		"math.sqrt(0.5)" 		>>$(SOURCEDIR)polynomial/__constants.asm
	#
	echo "Data & tables built."